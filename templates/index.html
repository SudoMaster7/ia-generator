<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUDO AI Lab</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts: Outfit -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>

<body>
    <div class="container-fluid py-3 h-100">
        <div class="row justify-content-center h-100">
            <div class="col-12 h-100">
                <div class="card shadow-lg h-100">
                    <div class="card-body p-4 d-flex flex-column">
                        <h2 class="title-text text-center mb-1">
                            <i class="fas fa-brain"></i> SUDO AI
                            <button class="btn btn-sm btn-outline-secondary ms-2" id="muteBtn" onclick="toggleMute()"
                                title="Ativar/Desativar Sons">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning ms-2" onclick="openSettings()"
                                title="Configura√ß√µes de Voz e Personalidade">
                                <i class="fas fa-cog"></i>
                            </button>
                            <a href="/audio" class="btn btn-sm btn-outline-info ms-2" title="Ir para Audio Lab">
                                <i class="fas fa-music"></i>
                            </a>
                            <a href="/ai" class="btn btn-sm btn-outline-danger ms-2" title="Ir para IA Personalizada">
                                <i class="fas fa-robot"></i> Karen
                            </a>
                        </h2>
                        <div class="text-center mb-4">
                            <span class="beta-badge">BETA</span>
                        </div>

                        <!-- ABAS -->
                        <ul class="nav nav-tabs mb-4" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="manual-tab" data-bs-toggle="tab"
                                    data-bs-target="#manualTab" type="button">
                                    <i class="fas fa-keyboard"></i> Prompt Manual
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="roulette-tab" data-bs-toggle="tab"
                                    data-bs-target="#rouletteTab" type="button">
                                    <i class="fas fa-circle-notch"></i> Roleta M√°gica
                                </button>
                            </li>
                            <!-- NOVA ABA GALERIA -->
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="gallery-tab" data-bs-toggle="tab"
                                    data-bs-target="#galleryTab" type="button">
                                    <i class="fas fa-images"></i> Galeria
                                </button>
                            </li>
                            <!-- NOVA ABA CHAT -->
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="chat-tab" data-bs-toggle="tab" data-bs-target="#chatTab"
                                    type="button">
                                    <i class="fas fa-comments"></i> Chat
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content flex-grow-1">
                            <!-- TAB 1: PROMPT MANUAL -->
                            <div class="tab-pane fade show active" id="manualTab">
                                <div class="row g-3 mb-4">
                                    <div class="col-md-9">
                                        <label class="form-label">
                                            <i class="fas fa-magic"></i> Prompt
                                        </label>
                                        <div class="input-group">
                                            <input type="text" id="promptInput" class="form-control"
                                                placeholder="Descreva sua imagem (ex: gato astronauta)...">
                                            <button class="btn btn-magic" type="button" onclick="enhancePrompt()"
                                                id="magicBtn" title="Usar IA para melhorar o prompt">
                                                <i class="fas fa-wand-magic-sparkles"></i> Melhorar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">
                                            <i class="fas fa-microchip"></i> Processador
                                        </label>
                                        <select id="deviceSelect" class="form-select">
                                            <option value="nano-banana">üçå Premium (Nano Banana)</option>
                                            <option value="cuda">GPU (NVIDIA)</option>
                                            <option value="cpu">CPU (Lento)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB 2: ROLETA M√ÅGICA -->
                            <div class="tab-pane fade" id="rouletteTab">
                                <div class="roulette-container">
                                    <h4 class="mb-4" style="color: #b4befe;">üé° Roleta de Prompts M√°gicos</h4>

                                    <div class="roulette-pointer"></div>
                                    <div class="roulette-wheel" id="rouletteWheel">
                                        <div class="roulette-center">SPIN!</div>
                                    </div>

                                    <div class="roulette-label" id="rouletteLabel">
                                        Clique em "Girar Roleta" para come√ßar! ‚ú®
                                    </div>

                                    <div class="roulette-buttons">
                                        <button class="btn btn-spin" onclick="spinRoulette()" id="spinBtn">
                                            <i class="fas fa-dice"></i> Girar Roleta
                                        </button>
                                        <button class="btn btn-magic" onclick="acceptRoulette()" id="acceptBtn"
                                            style="display: none;">
                                            <i class="fas fa-check"></i> Aceitar Prompt
                                        </button>
                                    </div>

                                    <div class="prompt-display" id="promptDisplay" style="display: none;">
                                        <strong>üìù Seu Prompt M√°gico:</strong><br>
                                        <span id="promptText"></span>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB 3: GALERIA -->
                            <div class="tab-pane fade" id="galleryTab">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 style="color: #b4befe;">üìÇ Hist√≥rico de Cria√ß√µes</h4>
                                    <button class="btn btn-sm btn-outline-light" onclick="loadGallery()">
                                        <i class="fas fa-sync-alt"></i> Atualizar
                                    </button>
                                </div>
                                <div id="galleryGrid" class="gallery-grid">
                                    <!-- Imagens ser√£o carregadas aqui via JS -->
                                    <div class="text-center w-100 mt-5 text-muted">Carregando galeria...</div>
                                </div>
                            </div>

                            <!-- TAB 4: CHAT -->
                            <div class="tab-pane fade" id="chatTab">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h4 class="mb-0" style="color: #b4befe;">üí¨ Chat Inteligente (Cloud)</h4>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="ttsToggle">
                                        <label class="form-check-label small text-muted" for="ttsToggle"><i
                                                class="fas fa-volume-up"></i> Ler Respostas</label>
                                    </div>
                                </div>

                                <div class="chat-container" id="chatContainer">
                                    <div class="chat-message ai">
                                        Ol√°! Eu sou sua IA assistente na nuvem. Como posso ajudar voc√™ hoje?
                                    </div>
                                </div>

                                <div class="chat-input-area">
                                    <input type="text" id="chatInput" placeholder="Digite sua mensagem..."
                                        onkeypress="handleChatKey(event)">
                                    <button class="btn btn-outline-secondary" onclick="startListening()" id="micBtn"
                                        title="Falar">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button class="btn btn-magic" onclick="sendChat()" id="sendChatBtn"
                                        style="width: auto; margin-bottom: 0;">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- BOT√ÉO GERAR (Comum) -->
                        <div id="generateBtnContainer">
                            <button class="btn btn-primary w-100 py-3 mb-4 mt-4" onclick="startGeneration()"
                                id="generateBtn">
                                <i class="fas fa-rocket"></i> GERAR IMAGEM
                            </button>
                        </div>

                        <!-- PROGRESSO -->
                        <div id="progressContainer" style="display: none;" class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span style="color: #b4befe;"><i class="fas fa-spinner fa-spin"></i> Gerando...</span>
                                <span id="progressText">0%</span>
                            </div>
                            <div class="progress mb-3" style="height: 25px;">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated"
                                    role="progressbar" style="width: 0%"></div>
                            </div>

                            <!-- BOT√ÉO CANCELAR -->
                            <button class="btn btn-danger w-100" onclick="cancelGeneration()" id="cancelBtn">
                                <i class="fas fa-stop-circle"></i> CANCELAR GERA√á√ÉO
                            </button>
                        </div>

                        <!-- RESULTADO -->
                        <div id="resultArea" class="text-center" style="display: none;">
                            <img id="resultImg" src="" alt="Resultado">

                            <div class="stats-box text-start">
                                <h5 class="mb-3 border-bottom pb-2">
                                    <i class="fas fa-chart-line"></i> Estat√≠sticas da Gera√ß√£o
                                </h5>
                                <div class="row">
                                    <div class="col-6 stat-item">
                                        <i class="far fa-clock"></i> Tempo Total: <strong id="statTime"></strong>
                                    </div>
                                    <div class="col-6 stat-item">
                                        <i class="fas fa-microchip"></i> Dispositivo: <strong id="statDevice"></strong>
                                    </div>
                                    <div class="col-6 stat-item">
                                        <i class="fas fa-shoe-prints"></i> Passos (Steps): <strong
                                            id="statSteps"></strong>
                                    </div>
                                    <div class="col-6 stat-item">
                                        <i class="fas fa-check-circle"></i> Status: <strong
                                            style="color: #a6e3a1;">Conclu√≠do</strong>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA VER IMAGEM GRANDE -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalhes da Imagem</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" src="" class="img-fluid rounded mb-3" style="max-height: 70vh;">
                    <div class="p-3 bg-dark rounded text-start">
                        <small class="text-muted">Prompt:</small>
                        <p id="modalPrompt" class="mb-0 text-white"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    <button type="button" class="btn btn-primary" onclick="reusePrompt()">
                        <i class="fas fa-redo"></i> Reutilizar Prompt
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DO JOGO (DINO RUN) -->
    <div class="modal fade" id="gameModal" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background-color: #2a2d3a; color: #e0e0e0; border: 2px solid #89b4fa;">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="fas fa-gamepad"></i> Dino Run - Enquanto espera...</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"
                        onclick="stopGame()"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <canvas id="gameCanvas" width="600" height="200"
                        style="background: #fff; border-radius: 8px; max-width: 100%; box-shadow: 0 0 20px rgba(137, 180, 250, 0.2);"></canvas>
                    <div class="mt-3">
                        <p class="mb-1">Pressione <strong>ESPA√áO</strong> ou <strong>TOQUE</strong> na tela para pular!
                        </p>
                        <h3 id="gameScore" style="color: #89b4fa; font-weight: bold;">Score: 0</h3>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-primary" onclick="startGame()">
                        <i class="fas fa-redo"></i> Reiniciar
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="stopGame()">
                        <i class="fas fa-times"></i> Fechar Jogo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE PERGUNTA (JOGAR?) -->
    <div class="modal fade" id="askGameModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: #2a2d3a; color: #e0e0e0;">
                <div class="modal-body text-center p-5">
                    <i class="fas fa-gamepad fa-4x mb-3" style="color: #fab387;"></i>
                    <h4>Gera√ß√£o Iniciada!</h4>
                    <p class="text-muted">Gostaria de jogar um minigame enquanto a IA cria sua imagem?</p>
                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-lg btn-primary" onclick="openGame()">
                            <i class="fas fa-play"></i> Sim, vamos jogar! ü¶ñ
                        </button>
                        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">
                            N√£o, vou s√≥ esperar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE CONFIGURA√á√ïES (VOZ & PERSONALIDADE) -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-sliders-h"></i> Configura√ß√µes do Chat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Personalidade -->
                    <div class="mb-4">
                        <label class="form-label"><i class="fas fa-user-astronaut"></i> Personalidade (System
                            Prompt)</label>
                        <textarea id="systemPromptInput" class="form-control" rows="3"
                            placeholder="Ex: Voc√™ √© um pirata rabugento..."></textarea>
                        <div class="form-text text-muted">Defina como a IA deve se comportar.</div>
                    </div>

                    <hr class="border-secondary">

                    <!-- Voz -->
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-microphone-alt"></i> Voz (Text-to-Speech)</label>
                        <select id="voiceSelect" class="form-select">
                            <option value="" disabled selected>Carregando vozes...</option>
                        </select>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <label class="form-label">Velocidade</label>
                            <input type="range" class="form-range" id="voiceRate" min="-50" max="50" value="0">
                            <div class="text-center small text-muted" id="voiceRateVal">0%</div>
                        </div>
                        <div class="col-6">
                            <label class="form-label">Tom (Pitch)</label>
                            <input type="range" class="form-range" id="voicePitch" min="-20" max="20" value="0">
                            <div class="text-center small text-muted" id="voicePitchVal">0Hz</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Salvar Configura√ß√µes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
</body>

</html>